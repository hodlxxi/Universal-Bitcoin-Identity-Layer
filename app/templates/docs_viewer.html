<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>HODLXXI Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { --g:#00ff88; --bg:#060b0a; --panel:rgba(0,0,0,.55); }
    body { margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
           background: radial-gradient(1200px 800px at 20% 10%, rgba(0,255,136,.10), transparent 60%),
                       radial-gradient(900px 700px at 80% 20%, rgba(0,180,255,.10), transparent 55%),
                       var(--bg);
           color:#d6ffe8; }
    .wrap { display:grid; grid-template-columns: 320px 1fr; height:100vh; }
    .side { border-right: 1px solid rgba(0,255,136,.25); background: var(--panel); padding:14px; overflow:auto; }
    .main { padding:14px; overflow:auto; }
    h1 { margin:0 0 10px; font-size:16px; color:var(--g); text-shadow:0 0 12px rgba(0,255,136,.35); }
    .item { display:block; padding:10px 10px; margin:6px 0; border:1px solid rgba(0,255,136,.18);
            border-radius:10px; color:#d6ffe8; text-decoration:none; }
    .item:hover { border-color: rgba(0,255,136,.5); box-shadow:0 0 16px rgba(0,255,136,.15); }
    .hint { opacity:.8; font-size:12px; margin-top:10px; line-height:1.4; }
    .viewer { border:1px solid rgba(0,255,136,.18); border-radius:12px; background: rgba(0,0,0,.35); padding:12px; }
    pre { white-space: pre-wrap; word-break: break-word; margin:0; }
    iframe { width:100%; height:78vh; border:0; border-radius:12px; background:#000; }
    .toprow { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .btn { padding:8px 10px; border-radius:10px; border:1px solid rgba(0,255,136,.18); background: rgba(0,0,0,.35);
           color:#d6ffe8; cursor:pointer; }
    .btn:hover { border-color: rgba(0,255,136,.5); }
    @media (max-width: 900px){ .wrap{ grid-template-columns: 1fr; } .side{ height:auto; } }
  </style>
</head>
<body>
  <div class="wrap">
    <aside class="side">
      <h1>/docs2 (preview)</h1>

      {% if items and items|length %}
        {% for name in items %}
          <a class="item" href="#" onclick='openDoc({{ name|tojson }}); return false;'>{{ name }}</a>
        {% endfor %}
      {% else %}
        <div class="hint">No docs found under <code>/srv/ubid/app/static/docs/docs/</code></div>
      {% endif %}

      <div class="hint">
        This viewer reads files from <code>/static/docs/docs/</code>.<br>
        Existing <code>/docs</code> is unchanged.
      </div>
    </aside>

    <main class="main">
      <div class="toprow">
        <div id="title" style="color:var(--g)">Select a file on the left</div>
        <div>
          <button class="btn" onclick="openRaw()">Open raw</button>
        </div>
      </div>

      <div id="content" class="viewer">
        <pre id="text">—</pre>
      </div>
    </main>
  </div>

<script>
  let currentUrl = null;

  function toStaticUrl(name){
    return "/static/docs/docs/" + encodeURIComponent(name);
  }

  async function openDoc(name){
    const url = toStaticUrl(name);
    currentUrl = url;
    document.getElementById("title").textContent = name;

    const lower = (name || "").toLowerCase();
    const content = document.getElementById("content");

    if(lower.endsWith(".pdf")){
      content.innerHTML = `<iframe src="${url}"></iframe>`;
      return;
    }

    content.innerHTML = `<pre id="text"></pre>`;
    const pre = document.getElementById("text");
    pre.textContent = "Loading…";

    try{
      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok){
        pre.textContent = "HTTP " + res.status + " while loading " + url;
        return;
      }
      const txt = await res.text();
      pre.textContent = txt;
    }catch(e){
      pre.textContent = "Failed to load: " + e;
    }
  }

  function openRaw(){
    if(currentUrl) window.open(currentUrl, "_blank", "noopener");
  }
</script>
</body>
</html>
